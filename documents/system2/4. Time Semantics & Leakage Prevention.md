**# Time Semantics & Leakage Controls**
**## Feature Time Windows**
All features in the Demand & Inventory Intelligence System are constructed using strict, backward-looking time windows anchored to a well-defined reference time (t₀).
* Features are computed using data available only up to and including t₀
* No feature uses information from t₀ + Δ or beyond
* Window sizes are explicitly parameterized and versioned
**Examples**
* Lagged sales: sales observed at t₀ − 1, t₀ − 7, t₀ − 28
* Rolling statistics: rolling mean and variance over [t₀ − 30, t₀]
* Promotion flags: known promotion schedules available before t₀
* Inventory state: latest inventory snapshot strictly ≤ t₀
Feature windows are aligned to the prediction horizon to ensure operational feasibility at inference time.

**## Label Generation**
Labels are generated using forward-looking outcome windows that start strictly after the feature reference time.
* **Demand Forecasting**
* Label: realized sales in the future horizon [t₀ + 1, t₀ + H]
* **Stock-Out Risk Prediction**
* Label: whether inventory level crosses zero within [t₀ + 1, t₀ + H]
* **Hierarchical Reconciliation**
* Labels are derived from aggregated future sales at corresponding hierarchy levels
Label generation uses delayed joins and explicit cut-off times to prevent accidental inclusion of future information.
All labeling logic is reproducible and tied to the same temporal assumptions used during evaluation and deployment.

**## Training vs Inference Parity**
The system enforces training–inference parity by sharing identical feature computation logic across environments.
* **Feature definitions are written once and reused for:**
* Offline training
* Batch inference
* Real-time inference (where applicable)
* **Feature availability constraints are enforced at inference time**
* **Features unavailable in production are excluded from training**
This ensures that models never depend on signals that are not accessible at prediction time, eliminating silent leakage during deployment.

**## Known Leakage Risks**
The following leakage risks are explicitly identified and mitigated:
* **Post-event inventory corrections**
* **Risk**: corrected inventory data reflecting future reconciliations
* **Mitigation**: use raw snapshots as-of time, not corrected balances
* **Promotion outcome leakage**
* **Risk**: using realized promotion lift instead of * planned promotion indicators
* **Mitigation**: only use promotion metadata known prior to t₀
* **Stock-out censoring**
* **Risk**: zero sales caused by stock-outs misinterpreted as zero demand
* **Mitigation**: explicit stock-out flags and censored-demand handling
* **Data latency leakage**
* **Risk**: late-arriving data included retroactively
* **Mitigation**: enforce data availability SLAs and cutoff timestamps
* **Aggregate leakage in hierarchical forecasts**
* **Risk**: higher-level aggregates computed using future SKU-level data
* **Mitigation**: aggregate only features available up to t₀
All leakage risks are tracked and tested through time-based validation and backtesting.